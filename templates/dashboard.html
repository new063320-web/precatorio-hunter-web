<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precat√≥rio Hunter v2.1</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #888;
            font-size: 1.1em;
        }
        
        .stats-bar {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px 30px;
            flex: 1;
            min-width: 200px;
        }
        
        .stat-card h3 {
            color: #888;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .section {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .section h2 {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .trf-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .trf-btn {
            padding: 10px 20px;
            border: 2px solid rgba(255,255,255,0.2);
            background: transparent;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1em;
        }
        
        .trf-btn:hover, .trf-btn.active {
            border-color: #00d4ff;
            background: rgba(0, 212, 255, 0.2);
        }
        
        textarea {
            width: 100%;
            height: 200px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            padding: 15px;
            color: #fff;
            font-family: monospace;
            font-size: 0.9em;
            resize: vertical;
        }
        
        textarea::placeholder {
            color: #666;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(90deg, #00d4ff, #00ff88);
            color: #1a1a2e;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-success {
            background: #00ff88;
            color: #1a1a2e;
        }
        
        .actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        th {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            font-weight: 600;
        }
        
        tr:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .valor {
            color: #00ff88;
            font-weight: bold;
        }
        
        .preferencia {
            font-size: 0.85em;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }
        
        .preferencia.sem {
            background: rgba(255,255,255,0.1);
            color: #888;
        }
        
        .status {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status.novo {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
        }
        
        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }
        
        .message.success {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
        }
        
        .message.error {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.show {
            display: block;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.show {
            display: flex;
        }
        
        .modal-content {
            background: #1a1a2e;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
        }
        
        .oferta-texto {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .stat-card { min-width: 100%; }
            table { font-size: 0.85em; }
            th, td { padding: 8px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Precat√≥rio Hunter v2.1</h1>
            <p class="subtitle">Sistema Inteligente de Capta√ß√£o de Precat√≥rios Federais</p>
        </header>
        
        <!-- Estat√≠sticas -->
        <div class="stats-bar">
            <div class="stat-card">
                <h3>üìä Total de Precat√≥rios</h3>
                <div class="value" id="total-precatorios">0</div>
            </div>
            <div class="stat-card">
                <h3>üí∞ Valor Total</h3>
                <div class="value" id="valor-total">R$ 0,00</div>
            </div>
            <div class="stat-card">
                <h3>üèõÔ∏è Tribunais</h3>
                <div class="value" id="total-tribunais">0</div>
            </div>
        </div>
        
        <!-- Se√ß√£o de Importa√ß√£o -->
        <div class="section">
            <h2>üì• Importar Tabela de Precat√≥rios</h2>
            
            <p style="color: #888; margin-bottom: 15px;">
                1. Selecione o Tribunal | 2. Cole a tabela do site | 3. Clique em Importar
            </p>
            
            <div class="trf-selector">
                <button class="trf-btn active" data-trf="TRF1">TRF1</button>
                <button class="trf-btn" data-trf="TRF2">TRF2</button>
                <button class="trf-btn" data-trf="TRF3">TRF3</button>
                <button class="trf-btn" data-trf="TRF4">TRF4</button>
                <button class="trf-btn" data-trf="TRF5">TRF5</button>
                <button class="trf-btn" data-trf="TRF6">TRF6</button>
            </div>
            
            <textarea id="tabela-input" placeholder="Cole aqui a tabela copiada do site do tribunal...

Exemplo:
1    2152200320244019198    119.945,29    Maior de 60 anos de idade
2    2152235520244019198    166.476,53    Maior de 60 anos de idade
3    2152252520244019198    165.330,71    Maior de 60 anos de idade"></textarea>
            
            <div class="actions">
                <button class="btn btn-primary" onclick="importarTabela()">
                    üì• Importar Dados
                </button>
                <button class="btn btn-secondary" onclick="limparCampo()">
                    üóëÔ∏è Limpar
                </button>
            </div>
            
            <div id="import-message" class="message"></div>
        </div>
        
        <!-- Se√ß√£o de Lista de Precat√≥rios -->
        <div class="section">
            <h2>üìã Lista de Precat√≥rios</h2>
            
            <div class="trf-selector">
                <button class="trf-btn filter-btn active" data-filter="">Todos</button>
                <button class="trf-btn filter-btn" data-filter="TRF1">TRF1</button>
                <button class="trf-btn filter-btn" data-filter="TRF2">TRF2</button>
                <button class="trf-btn filter-btn" data-filter="TRF3">TRF3</button>
                <button class="trf-btn filter-btn" data-filter="TRF4">TRF4</button>
                <button class="trf-btn filter-btn" data-filter="TRF5">TRF5</button>
                <button class="trf-btn filter-btn" data-filter="TRF6">TRF6</button>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Carregando precat√≥rios...</p>
            </div>
            
            <div id="tabela-container">
                <div class="empty-state" id="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                    <h3>Nenhum precat√≥rio importado</h3>
                    <p>Cole uma tabela acima para come√ßar</p>
                </div>
                
                <table id="precatorios-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>TRF</th>
                            <th>N¬∫ Precat√≥rio</th>
                            <th>Valor</th>
                            <th>Prefer√™ncia</th>
                            <th>Status</th>
                            <th>A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="precatorios-body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <!-- Modal de Oferta -->
    <div class="modal" id="modal-oferta">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìù Oferta Gerada</h3>
                <button class="modal-close" onclick="fecharModal()">&times;</button>
            </div>
            <div class="oferta-texto" id="oferta-texto"></div>
            <div class="actions" style="margin-top: 20px;">
                <button class="btn btn-success" onclick="copiarOferta()">üìã Copiar</button>
                <button class="btn btn-secondary" onclick="fecharModal()">Fechar</button>
            </div>
        </div>
    </div>
    
    <script>
        let trfSelecionado = 'TRF1';
        let filtroAtual = '';
        
        // Seletor de TRF para importa√ß√£o
        document.querySelectorAll('.trf-btn:not(.filter-btn)').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.trf-btn:not(.filter-btn)').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                trfSelecionado = btn.dataset.trf;
            });
        });
        
        // Filtro de TRF para listagem
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                filtroAtual = btn.dataset.filter;
                carregarPrecatorios();
            });
        });
        
        function formatarValor(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(valor);
        }
        
        function mostrarMensagem(tipo, texto) {
            const msg = document.getElementById('import-message');
            msg.className = `message ${tipo}`;
            msg.textContent = texto;
            msg.style.display = 'block';
            setTimeout(() => { msg.style.display = 'none'; }, 5000);
        }
        
        async function importarTabela() {
            const tabela = document.getElementById('tabela-input').value;
            
            if (!tabela.trim()) {
                mostrarMensagem('error', 'Por favor, cole a tabela antes de importar.');
                return;
            }
            
            try {
                const response = await fetch('/importar', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ trf: trfSelecionado, tabela: tabela })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    mostrarMensagem('success', data.message);
                    document.getElementById('tabela-input').value = '';
                    carregarPrecatorios();
                    carregarEstatisticas();
                } else {
                    mostrarMensagem('error', data.error);
                }
            } catch (error) {
                mostrarMensagem('error', 'Erro ao importar: ' + error.message);
            }
        }
        
        function limparCampo() {
            document.getElementById('tabela-input').value = '';
        }
        
        async function carregarPrecatorios() {
            const loading = document.getElementById('loading');
            const table = document.getElementById('precatorios-table');
            const empty = document.getElementById('empty-state');
            const tbody = document.getElementById('precatorios-body');
            
            loading.classList.add('show');
            table.style.display = 'none';
            empty.style.display = 'none';
            
            try {
                const url = filtroAtual ? `/precatorios?trf=${filtroAtual}` : '/precatorios';
                const response = await fetch(url);
                const data = await response.json();
                
                loading.classList.remove('show');
                
                if (data.success && data.precatorios.length > 0) {
                    tbody.innerHTML = '';
                    
                    data.precatorios.forEach(p => {
                        const prefClass = p.preferencia_legal === '-' ? 'sem' : '';
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td><strong>${p.trf}</strong></td>
                            <td style="font-family: monospace; font-size: 0.9em;">${p.numero_precatorio}</td>
                            <td class="valor">${formatarValor(p.valor)}</td>
                            <td><span class="preferencia ${prefClass}">${p.preferencia_legal || '-'}</span></td>
                            <td><span class="status novo">${p.status || 'novo'}</span></td>
                            <td>
                                <button class="btn btn-primary btn-small" onclick="gerarOferta(${p.id})">
                                    ‚ú® Gerar Oferta
                                </button>
                            </td>
                        `;
                        tbody.appendChild(tr);
                    });
                    
                    table.style.display = 'table';
                } else {
                    empty.style.display = 'block';
                }
            } catch (error) {
                loading.classList.remove('show');
                empty.style.display = 'block';
                console.error('Erro ao carregar precat√≥rios:', error);
            }
        }
        
        async function carregarEstatisticas() {
            try {
                const response = await fetch('/estatisticas');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('total-precatorios').textContent = 
                        data.total_geral.total || 0;
                    document.getElementById('valor-total').textContent = 
                        formatarValor(data.total_geral.valor_total || 0);
                    document.getElementById('total-tribunais').textContent = 
                        data.por_trf.length || 0;
                }
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }
        
        async function gerarOferta(id) {
            const btn = event.target;
            btn.textContent = '‚è≥ Gerando...';
            btn.disabled = true;
            
            try {
                const response = await fetch('/gerar-oferta', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ precatorio_id: id })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('oferta-texto').textContent = data.oferta;
                    document.getElementById('modal-oferta').classList.add('show');
                } else {
                    alert('Erro ao gerar oferta: ' + data.error);
                }
            } catch (error) {
                alert('Erro: ' + error.message);
            } finally {
                btn.textContent = '‚ú® Gerar Oferta';
                btn.disabled = false;
            }
        }
        
        function fecharModal() {
            document.getElementById('modal-oferta').classList.remove('show');
        }
        
        function copiarOferta() {
            const texto = document.getElementById('oferta-texto').textContent;
            navigator.clipboard.writeText(texto).then(() => {
                alert('Oferta copiada para a √°rea de transfer√™ncia!');
            });
        }
        
        // Carregar dados ao iniciar
        carregarPrecatorios();
        carregarEstatisticas();
    </script>
</body>
</html>
